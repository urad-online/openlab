!function(){tinymce.create("tinymce.plugins.Subscribe2Plugin",{init:function(a,b){var c=0,d='<img src="'+b+'/../include/spacer.gif" class="mceSubscribe2 mceItemNoResize" />',e="mceSubscribe2",f="[subscribe2]",g=[],h=new RegExp(/(\[|<!--)subscribe2.*?(\]|-->)/g),i=function(a){return-1!==a.indexOf('class="mceSubscribe2')&&(a=g[c]),a};a.addCommand("mceSubscribe2",function(){a.execCommand("mceInsertContent",0,d)}),a.addButton("subscribe2",{title:"Insert Subscribe2 Token",image:b+"/../include/s2-button.png",cmd:e}),a.onInit.add(function(){a.dom.loadCSS(b+"/css/content.min.css"),a.theme.onResolveName&&a.theme.onResolveName.add(function(b,c){"IMG"===c.node.nodeName&&a.dom.hasClass(c.node,e)&&(c.name="subscribe2")})}),a.onClick.add(function(a,b){b=b.target,"IMG"===b.nodeName&&a.dom.hasClass(b,e)&&a.selection.select(b)}),a.onNodeChange.add(function(a,b,c){b.setActive("subscribe2","IMG"===c.nodeName&&a.dom.hasClass(c,e))}),a.onBeforeSetContent.add(function(a,b){g=b.content.match(h),b.content=b.content.replace(h,d)}),a.onPostProcess.add(function(a,b){if(b.get){if(null!==g)for(c=0;c<g.length;c++)b.content=b.content.replace(/<img[^>]+>/,i);b.content=b.content.replace(/<img[^>]+>/g,function(a){return-1!==a.indexOf('class="mceSubscribe2')&&(a=f),a})}})},getInfo:function(){return{longname:"Insert Subscribe2 Token",author:"Matthew Robinson",authorurl:"http://subscribe2.wordpress.com",infourl:"http://subscribe2.wordpress.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("subscribe2",tinymce.plugins.Subscribe2Plugin)}();